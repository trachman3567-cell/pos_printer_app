name: Build Android Debug APK (no-wrapper)

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Unzip project archive
      # unzip the uploaded zip into appsrc folder
      run: |
        if [ -f pos_printer_app_with_cloud.zip ]; then
          unzip -q pos_printer_app_with_cloud.zip -d appsrc
        else
          echo "ZIP pos_printer_app_with_cloud.zip not found at repo root. Ensure you uploaded it."
          exit 2
        fi

    - name: Show appsrc tree (debug)
      run: ls -la appsrc || true

    - name: Setup JDK 17 (Temurin)
      uses: actions/setup-java@v4
      with:
        distribution: temurin
        java-version: 17

    - name: Install Gradle CLI
      uses: gradle/gradle-build-action@v2
      with:
        gradle-version: '8.4'   # compatible modern Gradle; change if needed

    - name: Print Gradle version (debug)
      run: gradle --version

    - name: Build Debug APK (use system gradle)
      working-directory: appsrc
      run: |
        # Clean then assemble debug
        gradle clean assembleDebug --no-daemon --console=plain

    - name: Show output files (debug)
      run: ls -la appsrc/app/build/outputs/apk/debug || true

    - name: Upload APK Artifact
      uses: actions/upload-artifact@v4
      with:
        name: pos_app_debug
        path: appsrc/app/build/outputs/apk/debug/*.apk
